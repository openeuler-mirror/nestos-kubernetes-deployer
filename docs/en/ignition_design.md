# Provide configuration
After the cluster infrastructure is successfully created, the operating system will enter the startup process. During this process, the ignition file will automatically obtain the required configuration information and write the configuration files such as user information, cluster certificates, cluster deployment services, etc. to the disk of the node machine. Subsequently, the systemd service will start to ensure that the system can run stably according to the preset rules and configurations. After the "release-image-pivot.service" service starts normally, it will build the required environment for cluster deployment. After the environment configuration is completed, the K8S cluster deployment service will officially start, which marks the official start of cluster deployment work. The entire process will continue until the service automatically shuts down after the cluster deployment is completed. NKD currently supports multiple ignition files including Ignition, cloud-init, and Kickstart files.

## Ignition
Ignition is a utility used by immutable infrastructure operating systems such as NestOS and Fedora CoreOS to operate disks during the initramfs phase, including creating users, adding trusted SSH keys, writing regular files, systemd services, network configurations, and more. Upon first boot, Ignition reads its configuration and applies it. Ignition uses a JSON configuration file to represent the set of changes to be made. The format of this configuration is detailed in the [specification](https://coreos.github.io/ignition/specs/).

The Ignition controlplane.ign file required for deploying a cluster generated by NKD is approximately 90KB, which declares the key components required during the cluster deployment process, including necessary systemd services and cluster certificates. However, when deploying a cluster on the OpenStack platform, due to the Nova user data limit of 64KB, it is not possible to directly create instances. To solve this problem, NKD created a stripped-down version of Ignition*-merge.ign file as a bootstrap configuration file when creating instances. At the same time, NKD loaded the main Ignition file controlplane.ign into a memory storage accessible through HTTP services.

The generated Ignition file directory structure is as follows：
``` shell
$ tree
.
├── controlplane.ign
├── controlplane-merge.ign
├── master.ign
├── master-merge.ign
├── worker.ign
└── worker-merge.ign
```
```shell
The content of the smaller "*-merge.ign" Ignition file is as follows:
Where:
    - IP: The address where the HTTP service is deployed, defaulting to the host machine's IP address.
    - port: The access port for the HTTP service, defaulting to port 9080.
    - {*.ign}: The primary Ignition files for executing cluster creation.
{
  "ignition": {
    "config": {
      "merge": [
        {
          "source": "http://{IP}:{port}/{*.ign}"
        }
      ]
    },
    "version": "3.2.0"
  }
}
```

## cloud-init
Cloud-init is an open source tool developed specifically for initializing virtual machine instances in cloud computing environments. During cluster deployment using NKD, the underlying operating system is selected as a general-purpose operating system. When deploying a cluster on a virtualization platform, a cloud-init file is generated, which configures the environment and cluster deployment services required for cluster deployment, such as:

- Configure the host name
- Install software packages on the instance
- Configure cluster environment
- Run the cluster installation script

## Kickstart
During the cluster deployment process using NKD, when the underlying operating system is selected as a general-purpose operating system and the cluster deployment is performed based on the PXE pre-boot execution environment platform, a kickstart file will be generated, which configures the environment and cluster deployment services required for cluster deployment, enabling a self-service installation method.
